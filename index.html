<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#03040a">
<title>Radar de Editais ‚Äî Virtus et Honor</title>

<!--
  Script cr√≠tico: define o background ANTES do CSS carregar.
  - Se o documento estiver em top (aberto diretamente), for√ßa fundo escuro.
  - Se estiver em iframe (embed), for√ßa transpar√™ncia para integrar com host.
-->
<script>
  (function earlyBgSetup(){
    try {
      const isEmbed = window.self !== window.top;
      if(isEmbed){
        document.documentElement.style.background = 'transparent';
        document.documentElement.style.setProperty('background-color','transparent','important');
        document.documentElement.dataset.embed = 'true';
      } else {
        // opened directly: enforce dark background to avoid light flash
        document.documentElement.style.background = '#03040a';
        document.documentElement.style.setProperty('background-color','#03040a','important');
      }
    } catch(e){
      // silently fail
    }
  })();
</script>

<style>
  :root{
    --bg-start:#03040a;
    --bg-end:#0b1118;
    --card-start:#071019;
    --card-end:#0f1723;
    --muted:rgba(230,230,230,.72);
    --accent-1:#8be9fd;
    --accent-2:#bd93f9;
    --accent-3:#ff79c6;
    --danger:#ff3b3b;
    --warn:#ffd93b;
    --info:#3ba0ff;
    --success:#50fa7b;
    --radius:12px;
    --max-default:980px;
    --max-wide:1320px;
    --transition:.18s;
    --font-sans:Inter,system-ui,-apple-system,"Segoe UI",Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  /* reset + defensive transparency rules */
  *,*::before,*::after{box-sizing:border-box}
  html,body{
    width:100%;
    height:100%;
    margin:0 !important;
    padding:0 !important;
    color:#e6e6e6;
    font-family:var(--font-sans);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    background: transparent; /* CSS fallback; early script above overrides for direct view */
  }

  /* If opened directly (not embed), early script will set html background to #03040a.
     For safety, provide a CSS fallback for top-level too via attribute check */
  html:not([data-embed]) body {
    background: linear-gradient(180deg,var(--bg-start),var(--bg-end));
    min-height:100vh;
  }

  /* If embedded (documentElement has data-embed), keep transparent and avoid outer padding */
  html[data-embed] body {
    background: transparent;
    min-height:0;
  }

  /* main wrapper - no outer padding that could produce border */
  #radarWrap{width:100%;max-width:var(--max-default);margin:0 auto;padding:0;transition:max-width var(--transition) ease}
  #radarWrap.wide{max-width:var(--max-wide)}

  /* panel */
  #radar{
    background: linear-gradient(180deg,var(--bg-start),var(--bg-end));
    border:1px solid rgba(255,255,255,.03);
    padding:16px;
    border-radius:14px;
    box-shadow:0 8px 30px rgba(2,6,23,.6);
  }

  /* header */
  .header{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px}
  .title{font-weight:800;font-size:18px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2),var(--accent-3));-webkit-background-clip:text;color:transparent}
  .subtitle{font-size:12px;color:var(--muted)}
  .controls{display:flex;gap:8px;align-items:center}

  .ctrl-btn{background:transparent;border:1px solid rgba(255,255,255,.04);padding:6px 10px;border-radius:8px;cursor:pointer;color:var(--muted);font-size:13px}
  .ctrl-btn:focus{outline:3px solid rgba(139,233,253,.12);outline-offset:3px}
  .ctrl-btn:hover{border-color:rgba(255,255,255,.08)}

  /* grid */
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;align-items:start}
  .card{grid-column:span 12;background:linear-gradient(145deg,var(--card-start),var(--card-end));border:1px solid rgba(255,255,255,.03);padding:14px;border-radius:var(--radius);position:relative;cursor:pointer;transition:transform .14s ease,border-color .14s ease,box-shadow .14s ease;user-select:none}
  .card:hover{transform:translateY(-4px) scale(1.01);box-shadow:0 12px 36px rgba(0,0,0,.5);border-color:rgba(255,255,255,.06)}
  #radarWrap.wide .card.half{grid-column:span 6}
  #radarWrap.wide .card.full{grid-column:span 12}

  .card::before{content:"";position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:6px 0 0 6px}
  .alvo::before{background:var(--danger)} .obs::before{background:var(--warn)} .reta::before{background:var(--info)}

  .head{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
  .name{font-weight:700;font-size:15px}
  .meta{font-size:12px;color:var(--muted)}
  .body{margin-top:8px;font-size:13px;color:rgba(230,230,230,.92);line-height:1.45}

  .pill{font-size:11px;padding:4px 8px;border-radius:999px;background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.03)}
  .pill.previsto{color:var(--accent-1);border-color:var(--accent-1)} .pill.autorizado{color:var(--success);border-color:var(--success)}
  .pill.pldo{color:var(--warn);border-color:var(--warn)} .pill.longo{color:var(--info);border-color:var(--info)}

  .note{margin-top:12px;font-size:12px;color:var(--muted);opacity:.95}

  /* modal */
  .modal-bg{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999;background:rgba(2,6,23,.6);backdrop-filter:blur(4px)}
  .modal-bg.open{display:flex}
  .modal{width:100%;max-width:980px;background:linear-gradient(180deg,#030512,#081026);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,.04);box-shadow:0 30px 80px rgba(2,6,23,.6);transform:translateY(6px) scale(.98);opacity:0;transition:transform var(--transition) ease,opacity var(--transition) ease;max-height:86vh;overflow:auto}
  .modal.open{transform:translateY(0) scale(1);opacity:1}
  .modal-header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
  .modal h3{font-size:18px;margin-bottom:6px}
  .modal .subtitle{font-size:12px;color:var(--muted)}
  .modal-body{margin-top:12px;font-size:14px;color:#e6e6e6;line-height:1.5;white-space:pre-wrap}
  .modal .fechar{background:transparent;border:none;color:var(--muted);font-size:16px;cursor:pointer;padding:6px;border-radius:8px}
  .modal .fechar:hover{color:#fff}

  @media (max-width:980px){
    #radarWrap{max-width:100%}
    #radarWrap.wide{max-width:100%}
    #radar{padding:12px}
    .card{padding:12px}
    .modal{max-width:94%;padding:16px}
  }

  .sr-only{position:absolute !important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  iframe,embed,object{background:transparent !important}
</style>
</head>

<body>
<div id="radarWrap" role="region" aria-label="Radar de Editais ‚Äî Virtus et Honor">
  <div id="radar" role="application" aria-describedby="radar-note">
    <div class="header">
      <div>
        <div class="title">üì° Radar de Editais ‚Äî Virtus et Honor</div>
        <div class="subtitle" id="updatedAt">Atualizado em: 20/02/2026</div>
      </div>

      <div class="controls" role="toolbar" aria-label="Controles do widget">
        <button id="toggleWide" class="ctrl-btn" title="Alternar largura (W)">‚Üî Largura</button>
        <button id="helpBtn" class="ctrl-btn" title="Ajuda (H)">i</button>
        <button id="copyLink" class="ctrl-btn" title="Copiar link p√∫blico">üîó Copiar link</button>
      </div>
    </div>

    <div class="grid" id="grid" role="list"></div>

    <div class="note" id="radar-note">Regra: monitorar apenas <strong>autoriza√ß√£o</strong>, <strong>comiss√£o</strong>, <strong>contrato de banca</strong> ou <strong>dota√ß√£o LOA/LDO</strong>. O resto √© inten√ß√£o.</div>
  </div>
</div>

<!-- MODAL -->
<div id="modalBg" class="modal-bg" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
    <div class="modal-header">
      <div>
        <h3 id="modalTitle">Resumo</h3>
        <div class="subtitle" id="modalSub">Fonte: Radar ‚Äî Virtus et Honor</div>
      </div>
      <div>
        <button class="fechar" id="modalClose" aria-label="Fechar">‚úï</button>
      </div>
    </div>
    <div class="modal-body" id="modalBody" tabindex="0"></div>
  </div>
</div>

<script>
/* === Conte√∫do (template literals) === */
const contentRepo = {
  pmgo:{title:"PM-GO ‚Äî Soldado",subtitle:"Prioridade M√°xima",html:`<strong>üëÅ‚Äçüó® Em Alvo</strong>\n- Edital prov√°vel entre <strong>julho e outubro de 2026</strong>.\n- Pico: <strong>set/2026</strong>.\n- Prova: <strong>nov/2026</strong>.`},
  prf:{title:"PRF ‚Äî Policial Rodovi√°rio Federal",subtitle:"Federal",html:`- Concurso 2021 prorrogado at√© <strong>jun/2026</strong>.\n- Novo edital prov√°vel no 2¬∫ semestre de 2026.`},
  pcmt:{title:"PC-MT",subtitle:"PLDO 2026",html:`Previsto no PLDO 2026. Edital projetado 2¬∫ semestre 2026.`},
  pmt:{title:"PM-MT",subtitle:"Or√ßamento",html:`Previsto no PLDO; depende de dota√ß√£o.`},
  pcdf:{title:"PC-DF",subtitle:"Autorizado",html:`105 vagas + 210 CR. Edital entre 2026‚Äì2027.`},
  pcpr:{title:"PC-PR",subtitle:"Autorizado",html:`Autorizado (fev/2026). Comiss√£o formada.`},
  pf:{title:"PF",subtitle:"Longo prazo",html:`Pr√≥ximo grande edital prov√°vel 2028+.`},
  pcgo:{title:"PC-GO",subtitle:"Em estudo",html:`Em estudo; possibilidade 2026‚Äì2027.`},
  pcto:{title:"PC-TO",subtitle:"Movimenta√ß√µes",html:`Comiss√µes e movimenta√ß√µes indicam 2026‚Äì2027.`},
  help_custom:{title:"Ajuda",subtitle:"Como usar",html:`- Clique em um card para abrir o resumo.\n- Fechar modal: ESC, clicar fora ou no ‚úï.\n- W: alternar largura. H: abrir ajuda.`}
};

/* === Cards dataset === */
const cardsData = [
  {key:'pmgo',class:'alvo full',pill:'PREVISTO'},
  {key:'prf',class:'alvo half',pill:'M√âDIO PRAZO'},
  {key:'pcmt',class:'obs half',pill:'PLDO'},
  {key:'pmt',class:'obs half',pill:'PLDO'},
  {key:'pcdf',class:'obs half',pill:'AUTORIZADO'},
  {key:'pcpr',class:'obs half',pill:'AUTORIZADO'},
  {key:'pf',class:'reta half',pill:'LONGO PRAZO'},
  {key:'pcgo',class:'reta half',pill:'ESTUDO'},
  {key:'pcto',class:'reta half',pill:'COMISS√ÉO'}
];

const grid = document.getElementById('grid');
const modalBg = document.getElementById('modalBg');
const modal = modalBg.querySelector('.modal');
const modalTitle = document.getElementById('modalTitle');
const modalSub = document.getElementById('modalSub');
const modalBody = document.getElementById('modalBody');
const toggleWideBtn = document.getElementById('toggleWide');
const helpBtn = document.getElementById('helpBtn');
const copyLinkBtn = document.getElementById('copyLink');

function stripTagsForPreview(html){
  const tmp = document.createElement('div'); tmp.innerHTML = html;
  const text = tmp.textContent || tmp.innerText || '';
  return text.length > 140 ? text.slice(0,137)+'...' : text;
}

function renderCards(){
  grid.innerHTML = '';
  for(const item of cardsData){
    const meta = contentRepo[item.key] || {title:item.key, subtitle:'', html:''};
    const el = document.createElement('div');
    el.className = `card ${item.class} card-click`;
    el.setAttribute('role','listitem');
    el.setAttribute('data-key', item.key);
    el.tabIndex = 0;
    el.innerHTML = `
      <div class="head">
        <div>
          <div class="name">${meta.title}</div>
          <div class="meta">${meta.subtitle || ''}</div>
        </div>
        <div><span class="pill">${item.pill || ''}</span></div>
      </div>
      <div class="body">${stripTagsForPreview(meta.html)}</div>
    `;
    el.addEventListener('click', ()=> openModal(item.key));
    el.addEventListener('keydown', (e)=> { if(e.key==='Enter'||e.key===' '){ e.preventDefault(); openModal(item.key); }});
    grid.appendChild(el);
  }
}

/* Modal open/close and focus management */
let lastFocused = null;
function openModal(key){
  const data = contentRepo[key];
  if(!data) return;
  lastFocused = document.activeElement;
  modalTitle.textContent = data.title || '';
  modalSub.textContent = data.subtitle || 'Radar ‚Äî Virtus et Honor';
  modalBody.innerHTML = data.html || '';
  modalBg.classList.add('open'); requestAnimationFrame(()=> modal.classList.add('open'));
  modalBg.setAttribute('aria-hidden','false');
  modal.setAttribute('tabindex','-1'); setTimeout(()=> modal.focus(),180);
  try{ document.documentElement.style.overflow='hidden'; }catch(e){}
}
function closeModal(){
  modal.classList.remove('open');
  modalBg.classList.remove('open');
  modalBg.setAttribute('aria-hidden','true');
  try{ document.documentElement.style.overflow=''; }catch(e){}
  if(lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
}
modalBg.addEventListener('click', (e)=>{ if(e.target===modalBg) closeModal(); });
document.getElementById('modalClose').addEventListener('click', closeModal);

/* keyboard shortcuts */
document.addEventListener('keydown', (e)=>{
  if(e.key==='Escape' && modalBg.classList.contains('open')) closeModal();
  if(!e.ctrlKey && !e.metaKey && !e.altKey){
    if(e.key.toLowerCase()==='w') toggleWide();
    if(e.key.toLowerCase()==='h') openModal('help_custom');
  }
});

/* focus trap (simple) */
document.addEventListener('focus', function(e){
  if(modalBg.classList.contains('open') && !modal.contains(e.target)){
    e.stopPropagation();
    modal.focus();
  }
}, true);

function toggleWide(){
  document.getElementById('radarWrap').classList.toggle('wide');
  toggleWideBtn.textContent = document.getElementById('radarWrap').classList.contains('wide') ? 'üóî Wide' : '‚Üî Largura';
}
toggleWideBtn.addEventListener('click', toggleWide);
helpBtn.addEventListener('click', ()=> openModal('help_custom'));

copyLinkBtn.addEventListener('click', ()=>{
  const url = (location.hostname && location.hostname.endsWith('github.io')) ? location.href : 'https://Fernando-NK.github.io/Widget-Notion/';
  navigator.clipboard?.writeText(url).then(()=>{
    copyLinkBtn.textContent='‚úì Copiado'; setTimeout(()=> copyLinkBtn.textContent='üîó Copiar link',1400);
  }).catch(()=>{ copyLinkBtn.textContent='Erro'; setTimeout(()=> copyLinkBtn.textContent='üîó Copiar link',1400); });
});

/* render */
renderCards();

/* Defensive runtime patch: if host injects white background on frameElement, attempt to neutralize */
(function runtimePatch(){
  try{
    const isEmbed = window.self !== window.top;
    if(!isEmbed){
      // explicit enforcement for top-level view (double-guard)
      document.documentElement.style.background = '#03040a';
      document.body.style.background = '#03040a';
      document.body.style.color = '#e6e6e6';
    } else {
      document.documentElement.setAttribute('data-embed','true');
      document.documentElement.style.background='transparent';
      document.body.style.background='transparent';
    }
    // remove margins if present
    document.body.style.margin='0';
    document.body.style.padding='0';
  }catch(e){}
})();

/* announce loaded for accessibility */
(function announce(){
  const live = document.createElement('div'); live.className='sr-only'; live.setAttribute('aria-live','polite'); live.textContent='Radar carregado'; document.body.appendChild(live);
  setTimeout(()=> live.remove(),2000);
})();
</script>
</body>
</html>
